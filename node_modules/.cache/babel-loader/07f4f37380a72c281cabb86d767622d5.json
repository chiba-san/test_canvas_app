{"ast":null,"code":"import { c as createNanoEvents, _ as __rest, a as __assign, b as __spreadArrays, p as proto } from './typings-79533271.js'; // Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n// find the complete implementation of crypto (msCrypto) on IE11.\n\nvar getRandomValues = typeof crypto != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto != 'undefined' && typeof msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto);\nvar rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\nfunction rng() {\n  if (!getRandomValues) {\n    throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n  }\n\n  return getRandomValues(rnds8);\n}\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex; // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n\n  return [bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]]].join('');\n}\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof options == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nvar createNanoObservable = function (observerFunc) {\n  var _a = createNanoEvents(),\n      on = _a.on,\n      emit = _a.emit;\n\n  var subscribe = function (_a) {\n    var next = _a.next;\n    var unsubscribe = on('next', next);\n    return {\n      unsubscribe: unsubscribe\n    };\n  };\n\n  observerFunc({\n    next: function (data) {\n      emit('next', data);\n    }\n  });\n  return {\n    subscribe: subscribe\n  };\n};\n\nfunction inIframe() {\n  try {\n    return window.self !== window.top;\n  } catch (e) {\n    return true;\n  }\n}\n\nif (typeof window !== 'undefined' && inIframe()) {\n  var postMessage_1 = function (action) {\n    var _a;\n\n    (_a = window.top) === null || _a === void 0 ? void 0 : _a.postMessage(JSON.stringify(action), '*');\n  };\n\n  window.appInitialData = [];\n  window.AssistantHost = {\n    sendDataContainer: function (json) {\n      postMessage_1({\n        type: 'sendDataContainer',\n        payload: json\n      });\n    },\n    close: function () {\n      postMessage_1({\n        type: 'close'\n      });\n    },\n    sendData: function (json) {\n      postMessage_1({\n        type: 'sendData',\n        payload: json\n      });\n    },\n    setSuggests: function (suggests) {\n      postMessage_1({\n        type: 'setSuggests',\n        payload: suggests\n      });\n    },\n    setHints: function (hints) {\n      postMessage_1({\n        type: 'setHints',\n        payload: hints\n      });\n    },\n    ready: function () {\n      postMessage_1({\n        type: 'ready'\n      });\n    },\n    sendText: function (message) {\n      postMessage_1({\n        type: 'sendText',\n        payload: message\n      });\n    }\n  };\n  window.addEventListener('message', function (e) {\n    var _a, _b, _c, _d, _e, _f, _g, _h;\n\n    try {\n      if (typeof e.data === 'string') {\n        var data = JSON.parse(e.data);\n\n        switch (data.type) {\n          case 'onData':\n            (_b = (_a = window.AssistantClient) === null || _a === void 0 ? void 0 : _a.onData) === null || _b === void 0 ? void 0 : _b.call(_a, data.payload);\n            break;\n\n          case 'onRequestState':\n            {\n              var state = (_d = (_c = window.AssistantClient) === null || _c === void 0 ? void 0 : _c.onRequestState) === null || _d === void 0 ? void 0 : _d.call(_c);\n              postMessage_1({\n                type: 'state',\n                payload: state,\n                requestId: data.requestId\n              });\n              break;\n            }\n\n          case 'onRequestRecoveryState':\n            {\n              var recoverystate = (_f = (_e = window.AssistantClient) === null || _e === void 0 ? void 0 : _e.onRequestRecoveryState) === null || _f === void 0 ? void 0 : _f.call(_e);\n              postMessage_1({\n                type: 'recoveryState',\n                payload: recoverystate\n              });\n              break;\n            }\n\n          case 'onStart':\n            (_h = (_g = window.AssistantClient) === null || _g === void 0 ? void 0 : _g.onStart) === null || _h === void 0 ? void 0 : _h.call(_g);\n            break;\n\n          default:\n            // eslint-disable-next-line no-console\n            console.error(e, 'Unknown parsed message');\n            break;\n        }\n      }\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error(err, 'Unknown message');\n    }\n  });\n}\n\nvar createAssistant = function (_a) {\n  var getState = _a.getState,\n      getRecoveryState = _a.getRecoveryState,\n      _b = _a.ready,\n      ready = _b === void 0 ? true : _b;\n  var currentGetState = getState;\n  var currentGetRecoveryState = getRecoveryState;\n  var isInitialDataReceived = false;\n  var isInitialCommandsEmitted = false;\n  /**\n   * Стартовые команды на момент `window.AssistantClient.onStart()`.\n   * Сохраняются однажды и не обновляются.\n   * */\n\n  var stackAppInitialData = [];\n  /**\n   * Стартовые команды, которые были получены методом `getInitialData()`.\n   * Они не будут заэмичены при `window.AssistantClient.onStart()`.\n   * */\n\n  var receivedAppInitialData = [];\n\n  var _c = createNanoEvents(),\n      on = _c.on,\n      emit = _c.emit;\n\n  var observables = new Map();\n\n  var emitCommand = function (command) {\n    if (command.type === 'smart_app_data') {\n      emit('command', command.smart_app_data);\n    }\n\n    if (command.type === 'smart_app_error') {\n      emit('error', command.smart_app_error);\n    }\n\n    return emit('data', command);\n  };\n\n  var findSystemCommandIndex = function (command) {\n    var _a, _b;\n\n    var index = -1;\n\n    if (command.type === 'character') {\n      index = stackAppInitialData.findIndex(function (c) {\n        return c.type === 'character' && c.character.id === command.character.id;\n      });\n    } else if (command.type === 'insets') {\n      index = stackAppInitialData.findIndex(function (c) {\n        return c.type === 'insets';\n      });\n    } else if (command.type === 'app_context') {\n      index = stackAppInitialData.findIndex(function (c) {\n        return c.type === 'app_context';\n      });\n    } else if (command.sdk_meta && ((_a = command.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid) && ((_b = command.sdk_meta) === null || _b === void 0 ? void 0 : _b.mid) !== '-1') {\n      index = stackAppInitialData.findIndex(function (c) {\n        var _a, _b;\n\n        return ((_a = c.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid) === ((_b = command.sdk_meta) === null || _b === void 0 ? void 0 : _b.mid);\n      });\n    }\n\n    return index;\n  };\n\n  var saveAppInitialData = function () {\n    stackAppInitialData = __spreadArrays(window.appInitialData || []);\n  };\n\n  var isCommandWasReceived = function (command) {\n    for (var _i = 0, receivedAppInitialData_1 = receivedAppInitialData; _i < receivedAppInitialData_1.length; _i++) {\n      var receivedCommand = receivedAppInitialData_1[_i];\n\n      if (receivedCommand === command) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var emitAppInitialData = function () {\n    if (!isInitialCommandsEmitted) {\n      var currentInitialData = stackAppInitialData;\n      var notReceivedCommands = isInitialDataReceived === true ? currentInitialData.filter(function (c) {\n        return !isCommandWasReceived(c);\n      }) : currentInitialData;\n      notReceivedCommands.forEach(function (c) {\n        return emitCommand(c);\n      });\n      isInitialCommandsEmitted = true;\n    }\n  };\n\n  window.AssistantClient = {\n    onData: function (command) {\n      var _a, _b, _c;\n\n      var commandIndex = findSystemCommandIndex(command);\n      var isCommandExist = commandIndex >= 0;\n\n      if (isCommandExist) {\n        stackAppInitialData.splice(commandIndex, 1);\n        return;\n      } /// фильтр команды 'назад'\n      /// может приходить type='system', но в типах это не отражаем\n      // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n      // @ts-ignore\n\n\n      if (command.type === 'system' && ((_b = (_a = command.system) === null || _a === void 0 ? void 0 : _a.command) === null || _b === void 0 ? void 0 : _b.toUpperCase()) === 'BACK') {\n        return;\n      }\n\n      if ((command.type === 'smart_app_data' || command.type === 'smart_app_error') && ((_c = command.sdk_meta) === null || _c === void 0 ? void 0 : _c.requestId) && observables.has(command.sdk_meta.requestId)) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        var _d = command.sdk_meta,\n            realReqId = _d.requestId,\n            meta = __rest(_d, [\"requestId\"]);\n\n        var _e = observables.get(command.sdk_meta.requestId) || {},\n            requestId = _e.requestId,\n            next = _e.next;\n\n        if (Object.keys(meta).length > 0 || requestId) {\n          // eslint-disable-next-line @typescript-eslint/camelcase\n          command.sdk_meta = __assign({}, meta);\n\n          if (requestId) {\n            // eslint-disable-next-line @typescript-eslint/camelcase\n            command.sdk_meta = {\n              requestId: requestId\n            };\n          }\n        }\n\n        if (next) {\n          next(command.type === 'smart_app_data' ? command : command);\n        }\n\n        return;\n      }\n\n      emitCommand(command);\n    },\n    onRequestState: function () {\n      return currentGetState();\n    },\n    onRequestRecoveryState: function () {\n      if (currentGetRecoveryState) {\n        return currentGetRecoveryState();\n      }\n\n      return undefined;\n    },\n    onStart: function () {\n      emit('start');\n      saveAppInitialData();\n      emitAppInitialData();\n    }\n  };\n\n  if (ready) {\n    setTimeout(function () {\n      var _a;\n\n      return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.ready();\n    }); // таймаут для подписки на start\n  }\n\n  var sendData = function (_a, onData) {\n    var _b, _c, _d;\n\n    var action = _a.action,\n        name = _a.name,\n        requestId = _a.requestId;\n\n    if ((_b = window.AssistantHost) === null || _b === void 0 ? void 0 : _b.sendDataContainer) {\n      if (onData == null) {\n        (_c = window.AssistantHost) === null || _c === void 0 ? void 0 : _c.sendDataContainer(\n        /* eslint-disable-next-line @typescript-eslint/camelcase */\n        JSON.stringify({\n          data: action,\n          message_name: name || '',\n          requestId: requestId\n        }));\n        return function () {};\n      }\n\n      if (requestId && observables.has(requestId)) {\n        throw new Error('requestId должен быть уникальным');\n      }\n\n      var subscribe = createNanoObservable(function (_a) {\n        var _b;\n\n        var next = _a.next;\n        var realRequestId = requestId || v4();\n        (_b = window.AssistantHost) === null || _b === void 0 ? void 0 : _b.sendDataContainer(\n        /* eslint-disable-next-line @typescript-eslint/camelcase */\n        JSON.stringify({\n          data: action,\n          message_name: name || '',\n          requestId: realRequestId\n        }));\n        observables.set(realRequestId, {\n          next: next,\n          requestId: requestId\n        });\n      }).subscribe;\n      return subscribe({\n        next: onData\n      }).unsubscribe;\n    }\n\n    if (onData != null) {\n      throw new Error('Не поддерживается в данной версии клиента');\n    }\n\n    (_d = window.AssistantHost) === null || _d === void 0 ? void 0 : _d.sendData(JSON.stringify(action), name || null);\n    return function () {};\n  };\n\n  return {\n    close: function () {\n      var _a;\n\n      return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.close();\n    },\n    getInitialData: function () {\n      isInitialDataReceived = true;\n      receivedAppInitialData = __spreadArrays(window.appInitialData || []);\n      return receivedAppInitialData;\n    },\n    findInInitialData: function (_a) {\n      var type = _a.type,\n          command = _a.command;\n\n      var appInitialData = __spreadArrays(window.appInitialData || []);\n\n      var result = appInitialData.find(function (data) {\n        if (!command && type && type === data.type) {\n          return true;\n        }\n\n        var isCommandInSmartAppData = command && 'smart_app_data' in data;\n\n        if (!isCommandInSmartAppData) {\n          return;\n        }\n\n        if (command === data.smart_app_data.command || command === data.smart_app_data.type) {\n          return true;\n        }\n\n        return false;\n      });\n      return result && 'smart_app_data' in result ? result.smart_app_data : result;\n    },\n    getRecoveryState: function () {\n      return window.appRecoveryState;\n    },\n    on: on,\n    sendAction: function (action, onData, onError, _a) {\n      var _b = _a === void 0 ? {} : _a,\n          name = _b.name,\n          requestId = _b.requestId;\n\n      return sendData({\n        action: action,\n        name: name,\n        requestId: requestId\n      }, function (data) {\n        if (data.type === 'smart_app_data' && onData) {\n          onData(data.smart_app_data);\n          return;\n        }\n\n        if (data.type === 'smart_app_error' && onError) {\n          onError(data.smart_app_error);\n          return;\n        }\n\n        emitCommand(data);\n      });\n    },\n    sendData: sendData,\n    setGetState: function (nextGetState) {\n      currentGetState = nextGetState;\n    },\n    setGetRecoveryState: function (nextGetRecoveryState) {\n      currentGetRecoveryState = nextGetRecoveryState;\n    },\n    setSuggests: function (suggestions) {\n      var _a;\n\n      (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.setSuggests(JSON.stringify({\n        suggestions: {\n          buttons: suggestions\n        }\n      }));\n    },\n    setHints: function (hints) {\n      var _a;\n\n      (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.setHints(JSON.stringify({\n        hints: hints\n      }));\n    },\n    sendText: function (message) {\n      var _a;\n\n      return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.sendText(message);\n    },\n    ready: function () {\n      var _a;\n\n      return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.ready();\n    }\n  };\n};\n\nexport { createAssistant as c, v4 as v };","map":{"version":3,"sources":["/Users/a19404057/Documents/assistant-client/assistant-client/examples/todo-canvas-app/node_modules/@sberdevices/assistant-client/esm/createAssistant-67a5c8c0.js"],"names":["c","createNanoEvents","_","__rest","a","__assign","b","__spreadArrays","p","proto","getRandomValues","crypto","bind","msCrypto","rnds8","Uint8Array","rng","Error","byteToHex","i","toString","substr","bytesToUuid","buf","offset","bth","join","v4","options","Array","rnds","random","ii","createNanoObservable","observerFunc","_a","on","emit","subscribe","next","unsubscribe","data","inIframe","window","self","top","e","postMessage_1","action","postMessage","JSON","stringify","appInitialData","AssistantHost","sendDataContainer","json","type","payload","close","sendData","setSuggests","suggests","setHints","hints","ready","sendText","message","addEventListener","_b","_c","_d","_e","_f","_g","_h","parse","AssistantClient","onData","call","state","onRequestState","requestId","recoverystate","onRequestRecoveryState","onStart","console","error","err","createAssistant","getState","getRecoveryState","currentGetState","currentGetRecoveryState","isInitialDataReceived","isInitialCommandsEmitted","stackAppInitialData","receivedAppInitialData","observables","Map","emitCommand","command","smart_app_data","smart_app_error","findSystemCommandIndex","index","findIndex","character","id","sdk_meta","mid","saveAppInitialData","isCommandWasReceived","_i","receivedAppInitialData_1","length","receivedCommand","emitAppInitialData","currentInitialData","notReceivedCommands","filter","forEach","commandIndex","isCommandExist","splice","system","toUpperCase","has","realReqId","meta","get","Object","keys","undefined","setTimeout","name","message_name","realRequestId","set","getInitialData","findInInitialData","result","find","isCommandInSmartAppData","appRecoveryState","sendAction","onError","setGetState","nextGetState","setGetRecoveryState","nextGetRecoveryState","suggestions","buttons","v"],"mappings":"AAAA,SAASA,CAAC,IAAIC,gBAAd,EAAgCC,CAAC,IAAIC,MAArC,EAA6CC,CAAC,IAAIC,QAAlD,EAA4DC,CAAC,IAAIC,cAAjE,EAAiFC,CAAC,IAAIC,KAAtF,QAAmG,uBAAnG,C,CAEA;AACA;AACA;AACA;AACA;;AACA,IAAIC,eAAe,GAAG,OAAOC,MAAP,IAAiB,WAAjB,IAAgCA,MAAM,CAACD,eAAvC,IAA0DC,MAAM,CAACD,eAAP,CAAuBE,IAAvB,CAA4BD,MAA5B,CAA1D,IAAiG,OAAOE,QAAP,IAAmB,WAAnB,IAAkC,OAAOA,QAAQ,CAACH,eAAhB,IAAmC,UAArE,IAAmFG,QAAQ,CAACH,eAAT,CAAyBE,IAAzB,CAA8BC,QAA9B,CAA1M;AACA,IAAIC,KAAK,GAAG,IAAIC,UAAJ,CAAe,EAAf,CAAZ,C,CAAgC;;AAEhC,SAASC,GAAT,GAAe;AACb,MAAI,CAACN,eAAL,EAAsB;AACpB,UAAM,IAAIO,KAAJ,CAAU,0GAAV,CAAN;AACD;;AAED,SAAOP,eAAe,CAACI,KAAD,CAAtB;AACD;AAED;AACA;AACA;AACA;;;AACA,IAAII,SAAS,GAAG,EAAhB;;AAEA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,GAApB,EAAyB,EAAEA,CAA3B,EAA8B;AAC5BD,EAAAA,SAAS,CAACC,CAAD,CAAT,GAAe,CAACA,CAAC,GAAG,KAAL,EAAYC,QAAZ,CAAqB,EAArB,EAAyBC,MAAzB,CAAgC,CAAhC,CAAf;AACD;;AAED,SAASC,WAAT,CAAqBC,GAArB,EAA0BC,MAA1B,EAAkC;AAChC,MAAIL,CAAC,GAAGK,MAAM,IAAI,CAAlB;AACA,MAAIC,GAAG,GAAGP,SAAV,CAFgC,CAEX;;AAErB,SAAO,CAACO,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAAJ,EAAgBM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAAnB,EAA+BM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAAlC,EAA8CM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAAjD,EAA6D,GAA7D,EAAkEM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAArE,EAAiFM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAApF,EAAgG,GAAhG,EAAqGM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAAxG,EAAoHM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAAvH,EAAmI,GAAnI,EAAwIM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAA3I,EAAuJM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAA1J,EAAsK,GAAtK,EAA2KM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAA9K,EAA0LM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAA7L,EAAyMM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAA5M,EAAwNM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAA3N,EAAuOM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAA1O,EAAsPM,GAAG,CAACF,GAAG,CAACJ,CAAC,EAAF,CAAJ,CAAzP,EAAqQO,IAArQ,CAA0Q,EAA1Q,CAAP;AACD;;AAED,SAASC,EAAT,CAAYC,OAAZ,EAAqBL,GAArB,EAA0BC,MAA1B,EAAkC;AAChC,MAAIL,CAAC,GAAGI,GAAG,IAAIC,MAAP,IAAiB,CAAzB;;AAEA,MAAI,OAAOI,OAAP,IAAkB,QAAtB,EAAgC;AAC9BL,IAAAA,GAAG,GAAGK,OAAO,KAAK,QAAZ,GAAuB,IAAIC,KAAJ,CAAU,EAAV,CAAvB,GAAuC,IAA7C;AACAD,IAAAA,OAAO,GAAG,IAAV;AACD;;AAEDA,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACA,MAAIE,IAAI,GAAGF,OAAO,CAACG,MAAR,IAAkB,CAACH,OAAO,CAACZ,GAAR,IAAeA,GAAhB,GAA7B,CATgC,CASqB;;AAErDc,EAAAA,IAAI,CAAC,CAAD,CAAJ,GAAUA,IAAI,CAAC,CAAD,CAAJ,GAAU,IAAV,GAAiB,IAA3B;AACAA,EAAAA,IAAI,CAAC,CAAD,CAAJ,GAAUA,IAAI,CAAC,CAAD,CAAJ,GAAU,IAAV,GAAiB,IAA3B,CAZgC,CAYC;;AAEjC,MAAIP,GAAJ,EAAS;AACP,SAAK,IAAIS,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAG,EAAtB,EAA0B,EAAEA,EAA5B,EAAgC;AAC9BT,MAAAA,GAAG,CAACJ,CAAC,GAAGa,EAAL,CAAH,GAAcF,IAAI,CAACE,EAAD,CAAlB;AACD;AACF;;AAED,SAAOT,GAAG,IAAID,WAAW,CAACQ,IAAD,CAAzB;AACD;;AAED,IAAIG,oBAAoB,GAAG,UAAUC,YAAV,EAAwB;AAC/C,MAAIC,EAAE,GAAGlC,gBAAgB,EAAzB;AAAA,MAA6BmC,EAAE,GAAGD,EAAE,CAACC,EAArC;AAAA,MAAyCC,IAAI,GAAGF,EAAE,CAACE,IAAnD;;AACA,MAAIC,SAAS,GAAG,UAAUH,EAAV,EAAc;AAC1B,QAAII,IAAI,GAAGJ,EAAE,CAACI,IAAd;AACA,QAAIC,WAAW,GAAGJ,EAAE,CAAC,MAAD,EAASG,IAAT,CAApB;AACA,WAAO;AAAEC,MAAAA,WAAW,EAAEA;AAAf,KAAP;AACH,GAJD;;AAKAN,EAAAA,YAAY,CAAC;AACTK,IAAAA,IAAI,EAAE,UAAUE,IAAV,EAAgB;AAClBJ,MAAAA,IAAI,CAAC,MAAD,EAASI,IAAT,CAAJ;AACH;AAHQ,GAAD,CAAZ;AAKA,SAAO;AACHH,IAAAA,SAAS,EAAEA;AADR,GAAP;AAGH,CAfD;;AAiBA,SAASI,QAAT,GAAoB;AAChB,MAAI;AACA,WAAOC,MAAM,CAACC,IAAP,KAAgBD,MAAM,CAACE,GAA9B;AACH,GAFD,CAGA,OAAOC,CAAP,EAAU;AACN,WAAO,IAAP;AACH;AACJ;;AACD,IAAI,OAAOH,MAAP,KAAkB,WAAlB,IAAiCD,QAAQ,EAA7C,EAAiD;AAC7C,MAAIK,aAAa,GAAG,UAAUC,MAAV,EAAkB;AAClC,QAAIb,EAAJ;;AACA,KAACA,EAAE,GAAGQ,MAAM,CAACE,GAAb,MAAsB,IAAtB,IAA8BV,EAAE,KAAK,KAAK,CAA1C,GAA8C,KAAK,CAAnD,GAAuDA,EAAE,CAACc,WAAH,CAAeC,IAAI,CAACC,SAAL,CAAeH,MAAf,CAAf,EAAuC,GAAvC,CAAvD;AACH,GAHD;;AAIAL,EAAAA,MAAM,CAACS,cAAP,GAAwB,EAAxB;AACAT,EAAAA,MAAM,CAACU,aAAP,GAAuB;AACnBC,IAAAA,iBAAiB,EAAE,UAAUC,IAAV,EAAgB;AAC/BR,MAAAA,aAAa,CAAC;AAAES,QAAAA,IAAI,EAAE,mBAAR;AAA6BC,QAAAA,OAAO,EAAEF;AAAtC,OAAD,CAAb;AACH,KAHkB;AAInBG,IAAAA,KAAK,EAAE,YAAY;AACfX,MAAAA,aAAa,CAAC;AAAES,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAb;AACH,KANkB;AAOnBG,IAAAA,QAAQ,EAAE,UAAUJ,IAAV,EAAgB;AACtBR,MAAAA,aAAa,CAAC;AAAES,QAAAA,IAAI,EAAE,UAAR;AAAoBC,QAAAA,OAAO,EAAEF;AAA7B,OAAD,CAAb;AACH,KATkB;AAUnBK,IAAAA,WAAW,EAAE,UAAUC,QAAV,EAAoB;AAC7Bd,MAAAA,aAAa,CAAC;AAAES,QAAAA,IAAI,EAAE,aAAR;AAAuBC,QAAAA,OAAO,EAAEI;AAAhC,OAAD,CAAb;AACH,KAZkB;AAanBC,IAAAA,QAAQ,EAAE,UAAUC,KAAV,EAAiB;AACvBhB,MAAAA,aAAa,CAAC;AAAES,QAAAA,IAAI,EAAE,UAAR;AAAoBC,QAAAA,OAAO,EAAEM;AAA7B,OAAD,CAAb;AACH,KAfkB;AAgBnBC,IAAAA,KAAK,EAAE,YAAY;AACfjB,MAAAA,aAAa,CAAC;AAAES,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAb;AACH,KAlBkB;AAmBnBS,IAAAA,QAAQ,EAAE,UAAUC,OAAV,EAAmB;AACzBnB,MAAAA,aAAa,CAAC;AAAES,QAAAA,IAAI,EAAE,UAAR;AAAoBC,QAAAA,OAAO,EAAES;AAA7B,OAAD,CAAb;AACH;AArBkB,GAAvB;AAuBAvB,EAAAA,MAAM,CAACwB,gBAAP,CAAwB,SAAxB,EAAmC,UAAUrB,CAAV,EAAa;AAC5C,QAAIX,EAAJ,EAAQiC,EAAR,EAAYC,EAAZ,EAAgBC,EAAhB,EAAoBC,EAApB,EAAwBC,EAAxB,EAA4BC,EAA5B,EAAgCC,EAAhC;;AACA,QAAI;AACA,UAAI,OAAO5B,CAAC,CAACL,IAAT,KAAkB,QAAtB,EAAgC;AAC5B,YAAIA,IAAI,GAAGS,IAAI,CAACyB,KAAL,CAAW7B,CAAC,CAACL,IAAb,CAAX;;AACA,gBAAQA,IAAI,CAACe,IAAb;AACI,eAAK,QAAL;AACI,aAACY,EAAE,GAAG,CAACjC,EAAE,GAAGQ,MAAM,CAACiC,eAAb,MAAkC,IAAlC,IAA0CzC,EAAE,KAAK,KAAK,CAAtD,GAA0D,KAAK,CAA/D,GAAmEA,EAAE,CAAC0C,MAA5E,MAAwF,IAAxF,IAAgGT,EAAE,KAAK,KAAK,CAA5G,GAAgH,KAAK,CAArH,GAAyHA,EAAE,CAACU,IAAH,CAAQ3C,EAAR,EAAYM,IAAI,CAACgB,OAAjB,CAAzH;AACA;;AACJ,eAAK,gBAAL;AAAuB;AACnB,kBAAIsB,KAAK,GAAG,CAACT,EAAE,GAAG,CAACD,EAAE,GAAG1B,MAAM,CAACiC,eAAb,MAAkC,IAAlC,IAA0CP,EAAE,KAAK,KAAK,CAAtD,GAA0D,KAAK,CAA/D,GAAmEA,EAAE,CAACW,cAA5E,MAAgG,IAAhG,IAAwGV,EAAE,KAAK,KAAK,CAApH,GAAwH,KAAK,CAA7H,GAAiIA,EAAE,CAACQ,IAAH,CAAQT,EAAR,CAA7I;AACAtB,cAAAA,aAAa,CAAC;AAAES,gBAAAA,IAAI,EAAE,OAAR;AAAiBC,gBAAAA,OAAO,EAAEsB,KAA1B;AAAiCE,gBAAAA,SAAS,EAAExC,IAAI,CAACwC;AAAjD,eAAD,CAAb;AACA;AACH;;AACD,eAAK,wBAAL;AAA+B;AAC3B,kBAAIC,aAAa,GAAG,CAACV,EAAE,GAAG,CAACD,EAAE,GAAG5B,MAAM,CAACiC,eAAb,MAAkC,IAAlC,IAA0CL,EAAE,KAAK,KAAK,CAAtD,GAA0D,KAAK,CAA/D,GAAmEA,EAAE,CAACY,sBAA5E,MAAwG,IAAxG,IAAgHX,EAAE,KAAK,KAAK,CAA5H,GAAgI,KAAK,CAArI,GAAyIA,EAAE,CAACM,IAAH,CAAQP,EAAR,CAA7J;AACAxB,cAAAA,aAAa,CAAC;AAAES,gBAAAA,IAAI,EAAE,eAAR;AAAyBC,gBAAAA,OAAO,EAAEyB;AAAlC,eAAD,CAAb;AACA;AACH;;AACD,eAAK,SAAL;AACI,aAACR,EAAE,GAAG,CAACD,EAAE,GAAG9B,MAAM,CAACiC,eAAb,MAAkC,IAAlC,IAA0CH,EAAE,KAAK,KAAK,CAAtD,GAA0D,KAAK,CAA/D,GAAmEA,EAAE,CAACW,OAA5E,MAAyF,IAAzF,IAAiGV,EAAE,KAAK,KAAK,CAA7G,GAAiH,KAAK,CAAtH,GAA0HA,EAAE,CAACI,IAAH,CAAQL,EAAR,CAA1H;AACA;;AACJ;AACI;AACAY,YAAAA,OAAO,CAACC,KAAR,CAAcxC,CAAd,EAAiB,wBAAjB;AACA;AApBR;AAsBH;AACJ,KA1BD,CA2BA,OAAOyC,GAAP,EAAY;AACR;AACAF,MAAAA,OAAO,CAACC,KAAR,CAAcC,GAAd,EAAmB,iBAAnB;AACH;AACJ,GAjCD;AAkCH;;AACD,IAAIC,eAAe,GAAG,UAAUrD,EAAV,EAAc;AAChC,MAAIsD,QAAQ,GAAGtD,EAAE,CAACsD,QAAlB;AAAA,MAA4BC,gBAAgB,GAAGvD,EAAE,CAACuD,gBAAlD;AAAA,MAAoEtB,EAAE,GAAGjC,EAAE,CAAC6B,KAA5E;AAAA,MAAmFA,KAAK,GAAGI,EAAE,KAAK,KAAK,CAAZ,GAAgB,IAAhB,GAAuBA,EAAlH;AACA,MAAIuB,eAAe,GAAGF,QAAtB;AACA,MAAIG,uBAAuB,GAAGF,gBAA9B;AACA,MAAIG,qBAAqB,GAAG,KAA5B;AACA,MAAIC,wBAAwB,GAAG,KAA/B;AACA;AACJ;AACA;AACA;;AACI,MAAIC,mBAAmB,GAAG,EAA1B;AACA;AACJ;AACA;AACA;;AACI,MAAIC,sBAAsB,GAAG,EAA7B;;AACA,MAAI3B,EAAE,GAAGpE,gBAAgB,EAAzB;AAAA,MAA6BmC,EAAE,GAAGiC,EAAE,CAACjC,EAArC;AAAA,MAAyCC,IAAI,GAAGgC,EAAE,CAAChC,IAAnD;;AACA,MAAI4D,WAAW,GAAG,IAAIC,GAAJ,EAAlB;;AACA,MAAIC,WAAW,GAAG,UAAUC,OAAV,EAAmB;AACjC,QAAIA,OAAO,CAAC5C,IAAR,KAAiB,gBAArB,EAAuC;AACnCnB,MAAAA,IAAI,CAAC,SAAD,EAAY+D,OAAO,CAACC,cAApB,CAAJ;AACH;;AACD,QAAID,OAAO,CAAC5C,IAAR,KAAiB,iBAArB,EAAwC;AACpCnB,MAAAA,IAAI,CAAC,OAAD,EAAU+D,OAAO,CAACE,eAAlB,CAAJ;AACH;;AACD,WAAOjE,IAAI,CAAC,MAAD,EAAS+D,OAAT,CAAX;AACH,GARD;;AASA,MAAIG,sBAAsB,GAAG,UAAUH,OAAV,EAAmB;AAC5C,QAAIjE,EAAJ,EAAQiC,EAAR;;AACA,QAAIoC,KAAK,GAAG,CAAC,CAAb;;AACA,QAAIJ,OAAO,CAAC5C,IAAR,KAAiB,WAArB,EAAkC;AAC9BgD,MAAAA,KAAK,GAAGT,mBAAmB,CAACU,SAApB,CAA8B,UAAUzG,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACwD,IAAF,KAAW,WAAX,IAA0BxD,CAAC,CAAC0G,SAAF,CAAYC,EAAZ,KAAmBP,OAAO,CAACM,SAAR,CAAkBC,EAAtE;AAA2E,OAAxH,CAAR;AACH,KAFD,MAGK,IAAIP,OAAO,CAAC5C,IAAR,KAAiB,QAArB,EAA+B;AAChCgD,MAAAA,KAAK,GAAGT,mBAAmB,CAACU,SAApB,CAA8B,UAAUzG,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACwD,IAAF,KAAW,QAAlB;AAA6B,OAA1E,CAAR;AACH,KAFI,MAGA,IAAI4C,OAAO,CAAC5C,IAAR,KAAiB,aAArB,EAAoC;AACrCgD,MAAAA,KAAK,GAAGT,mBAAmB,CAACU,SAApB,CAA8B,UAAUzG,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACwD,IAAF,KAAW,aAAlB;AAAkC,OAA/E,CAAR;AACH,KAFI,MAGA,IAAI4C,OAAO,CAACQ,QAAR,KAAqB,CAACzE,EAAE,GAAGiE,OAAO,CAACQ,QAAd,MAA4B,IAA5B,IAAoCzE,EAAE,KAAK,KAAK,CAAhD,GAAoD,KAAK,CAAzD,GAA6DA,EAAE,CAAC0E,GAArF,KAA6F,CAAC,CAACzC,EAAE,GAAGgC,OAAO,CAACQ,QAAd,MAA4B,IAA5B,IAAoCxC,EAAE,KAAK,KAAK,CAAhD,GAAoD,KAAK,CAAzD,GAA6DA,EAAE,CAACyC,GAAjE,MAA0E,IAA3K,EAAiL;AAClLL,MAAAA,KAAK,GAAGT,mBAAmB,CAACU,SAApB,CAA8B,UAAUzG,CAAV,EAAa;AAAE,YAAImC,EAAJ,EAAQiC,EAAR;;AAAY,eAAO,CAAC,CAACjC,EAAE,GAAGnC,CAAC,CAAC4G,QAAR,MAAsB,IAAtB,IAA8BzE,EAAE,KAAK,KAAK,CAA1C,GAA8C,KAAK,CAAnD,GAAuDA,EAAE,CAAC0E,GAA3D,OAAqE,CAACzC,EAAE,GAAGgC,OAAO,CAACQ,QAAd,MAA4B,IAA5B,IAAoCxC,EAAE,KAAK,KAAK,CAAhD,GAAoD,KAAK,CAAzD,GAA6DA,EAAE,CAACyC,GAArI,CAAP;AAAmJ,OAA5M,CAAR;AACH;;AACD,WAAOL,KAAP;AACH,GAhBD;;AAiBA,MAAIM,kBAAkB,GAAG,YAAY;AACjCf,IAAAA,mBAAmB,GAAGxF,cAAc,CAAEoC,MAAM,CAACS,cAAP,IAAyB,EAA3B,CAApC;AACH,GAFD;;AAGA,MAAI2D,oBAAoB,GAAG,UAAUX,OAAV,EAAmB;AAC1C,SAAK,IAAIY,EAAE,GAAG,CAAT,EAAYC,wBAAwB,GAAGjB,sBAA5C,EAAoEgB,EAAE,GAAGC,wBAAwB,CAACC,MAAlG,EAA0GF,EAAE,EAA5G,EAAgH;AAC5G,UAAIG,eAAe,GAAGF,wBAAwB,CAACD,EAAD,CAA9C;;AACA,UAAIG,eAAe,KAAKf,OAAxB,EAAiC;AAC7B,eAAO,IAAP;AACH;AACJ;;AACD,WAAO,KAAP;AACH,GARD;;AASA,MAAIgB,kBAAkB,GAAG,YAAY;AACjC,QAAI,CAACtB,wBAAL,EAA+B;AAC3B,UAAIuB,kBAAkB,GAAGtB,mBAAzB;AACA,UAAIuB,mBAAmB,GAAGzB,qBAAqB,KAAK,IAA1B,GACpBwB,kBAAkB,CAACE,MAAnB,CAA0B,UAAUvH,CAAV,EAAa;AAAE,eAAO,CAAC+G,oBAAoB,CAAC/G,CAAD,CAA5B;AAAkC,OAA3E,CADoB,GAEpBqH,kBAFN;AAGAC,MAAAA,mBAAmB,CAACE,OAApB,CAA4B,UAAUxH,CAAV,EAAa;AAAE,eAAOmG,WAAW,CAACnG,CAAD,CAAlB;AAAwB,OAAnE;AACA8F,MAAAA,wBAAwB,GAAG,IAA3B;AACH;AACJ,GATD;;AAUAnD,EAAAA,MAAM,CAACiC,eAAP,GAAyB;AACrBC,IAAAA,MAAM,EAAE,UAAUuB,OAAV,EAAmB;AACvB,UAAIjE,EAAJ,EAAQiC,EAAR,EAAYC,EAAZ;;AACA,UAAIoD,YAAY,GAAGlB,sBAAsB,CAACH,OAAD,CAAzC;AACA,UAAIsB,cAAc,GAAGD,YAAY,IAAI,CAArC;;AACA,UAAIC,cAAJ,EAAoB;AAChB3B,QAAAA,mBAAmB,CAAC4B,MAApB,CAA2BF,YAA3B,EAAyC,CAAzC;AACA;AACH,OAPsB,CAQvB;AACA;AACA;AACA;;;AACA,UAAIrB,OAAO,CAAC5C,IAAR,KAAiB,QAAjB,IAA6B,CAAC,CAACY,EAAE,GAAG,CAACjC,EAAE,GAAGiE,OAAO,CAACwB,MAAd,MAA0B,IAA1B,IAAkCzF,EAAE,KAAK,KAAK,CAA9C,GAAkD,KAAK,CAAvD,GAA2DA,EAAE,CAACiE,OAApE,MAAiF,IAAjF,IAAyFhC,EAAE,KAAK,KAAK,CAArG,GAAyG,KAAK,CAA9G,GAAkHA,EAAE,CAACyD,WAAH,EAAnH,MAAyI,MAA1K,EAAkL;AAC9K;AACH;;AACD,UAAI,CAACzB,OAAO,CAAC5C,IAAR,KAAiB,gBAAjB,IAAqC4C,OAAO,CAAC5C,IAAR,KAAiB,iBAAvD,MAA8E,CAACa,EAAE,GAAG+B,OAAO,CAACQ,QAAd,MAA4B,IAA5B,IAAoCvC,EAAE,KAAK,KAAK,CAAhD,GAAoD,KAAK,CAAzD,GAA6DA,EAAE,CAACY,SAA9I,KACAgB,WAAW,CAAC6B,GAAZ,CAAgB1B,OAAO,CAACQ,QAAR,CAAiB3B,SAAjC,CADJ,EACiD;AAC7C;AACA,YAAIX,EAAE,GAAG8B,OAAO,CAACQ,QAAjB;AAAA,YAA2BmB,SAAS,GAAGzD,EAAE,CAACW,SAA1C;AAAA,YAAqD+C,IAAI,GAAG7H,MAAM,CAACmE,EAAD,EAAK,CAAC,WAAD,CAAL,CAAlE;;AACA,YAAIC,EAAE,GAAG0B,WAAW,CAACgC,GAAZ,CAAgB7B,OAAO,CAACQ,QAAR,CAAiB3B,SAAjC,KAA+C,EAAxD;AAAA,YAA4DA,SAAS,GAAGV,EAAE,CAACU,SAA3E;AAAA,YAAsF1C,IAAI,GAAGgC,EAAE,CAAChC,IAAhG;;AACA,YAAI2F,MAAM,CAACC,IAAP,CAAYH,IAAZ,EAAkBd,MAAlB,GAA2B,CAA3B,IAAgCjC,SAApC,EAA+C;AAC3C;AACAmB,UAAAA,OAAO,CAACQ,QAAR,GAAmBvG,QAAQ,CAAC,EAAD,EAAK2H,IAAL,CAA3B;;AACA,cAAI/C,SAAJ,EAAe;AACX;AACAmB,YAAAA,OAAO,CAACQ,QAAR,GAAmB;AAAE3B,cAAAA,SAAS,EAAEA;AAAb,aAAnB;AACH;AACJ;;AACD,YAAI1C,IAAJ,EAAU;AACNA,UAAAA,IAAI,CAAC6D,OAAO,CAAC5C,IAAR,KAAiB,gBAAjB,GAAoC4C,OAApC,GAA8CA,OAA/C,CAAJ;AACH;;AACD;AACH;;AACDD,MAAAA,WAAW,CAACC,OAAD,CAAX;AACH,KAnCoB;AAoCrBpB,IAAAA,cAAc,EAAE,YAAY;AACxB,aAAOW,eAAe,EAAtB;AACH,KAtCoB;AAuCrBR,IAAAA,sBAAsB,EAAE,YAAY;AAChC,UAAIS,uBAAJ,EAA6B;AACzB,eAAOA,uBAAuB,EAA9B;AACH;;AACD,aAAOwC,SAAP;AACH,KA5CoB;AA6CrBhD,IAAAA,OAAO,EAAE,YAAY;AACjB/C,MAAAA,IAAI,CAAC,OAAD,CAAJ;AACAyE,MAAAA,kBAAkB;AAClBM,MAAAA,kBAAkB;AACrB;AAjDoB,GAAzB;;AAmDA,MAAIpD,KAAJ,EAAW;AACPqE,IAAAA,UAAU,CAAC,YAAY;AAAE,UAAIlG,EAAJ;;AAAQ,aAAO,CAACA,EAAE,GAAGQ,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwClB,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAAC6B,KAAH,EAAxE;AAAqF,KAA5G,CAAV,CADO,CACkH;AAC5H;;AACD,MAAIL,QAAQ,GAAG,UAAUxB,EAAV,EAAc0C,MAAd,EAAsB;AACjC,QAAIT,EAAJ,EAAQC,EAAR,EAAYC,EAAZ;;AACA,QAAItB,MAAM,GAAGb,EAAE,CAACa,MAAhB;AAAA,QAAwBsF,IAAI,GAAGnG,EAAE,CAACmG,IAAlC;AAAA,QAAwCrD,SAAS,GAAG9C,EAAE,CAAC8C,SAAvD;;AACA,QAAI,CAACb,EAAE,GAAGzB,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwCe,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAACd,iBAAxE,EAA2F;AACvF,UAAIuB,MAAM,IAAI,IAAd,EAAoB;AAChB,SAACR,EAAE,GAAG1B,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwCgB,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAACf,iBAAH;AACjE;AACAJ,QAAAA,IAAI,CAACC,SAAL,CAAe;AAAEV,UAAAA,IAAI,EAAEO,MAAR;AAAgBuF,UAAAA,YAAY,EAAED,IAAI,IAAI,EAAtC;AAA0CrD,UAAAA,SAAS,EAAEA;AAArD,SAAf,CAFiE,CAAjE;AAGA,eAAO,YAAY,CAAG,CAAtB;AACH;;AACD,UAAIA,SAAS,IAAIgB,WAAW,CAAC6B,GAAZ,CAAgB7C,SAAhB,CAAjB,EAA6C;AACzC,cAAM,IAAIhE,KAAJ,CAAU,kCAAV,CAAN;AACH;;AACD,UAAIqB,SAAS,GAAGL,oBAAoB,CAAC,UAAUE,EAAV,EAAc;AAC/C,YAAIiC,EAAJ;;AACA,YAAI7B,IAAI,GAAGJ,EAAE,CAACI,IAAd;AACA,YAAIiG,aAAa,GAAGvD,SAAS,IAAItD,EAAE,EAAnC;AACA,SAACyC,EAAE,GAAGzB,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwCe,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAACd,iBAAH;AACjE;AACAJ,QAAAA,IAAI,CAACC,SAAL,CAAe;AAAEV,UAAAA,IAAI,EAAEO,MAAR;AAAgBuF,UAAAA,YAAY,EAAED,IAAI,IAAI,EAAtC;AAA0CrD,UAAAA,SAAS,EAAEuD;AAArD,SAAf,CAFiE,CAAjE;AAGAvC,QAAAA,WAAW,CAACwC,GAAZ,CAAgBD,aAAhB,EAA+B;AAAEjG,UAAAA,IAAI,EAAEA,IAAR;AAAc0C,UAAAA,SAAS,EAAEA;AAAzB,SAA/B;AACH,OARmC,CAApB,CAQb3C,SARH;AASA,aAAOA,SAAS,CAAC;AAAEC,QAAAA,IAAI,EAAEsC;AAAR,OAAD,CAAT,CAA4BrC,WAAnC;AACH;;AACD,QAAIqC,MAAM,IAAI,IAAd,EAAoB;AAChB,YAAM,IAAI5D,KAAJ,CAAU,2CAAV,CAAN;AACH;;AACD,KAACqD,EAAE,GAAG3B,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwCiB,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAACX,QAAH,CAAYT,IAAI,CAACC,SAAL,CAAeH,MAAf,CAAZ,EAAoCsF,IAAI,IAAI,IAA5C,CAAjE;AACA,WAAO,YAAY,CAAG,CAAtB;AACH,GA7BD;;AA8BA,SAAO;AACH5E,IAAAA,KAAK,EAAE,YAAY;AAAE,UAAIvB,EAAJ;;AAAQ,aAAO,CAACA,EAAE,GAAGQ,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwClB,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAACuB,KAAH,EAAxE;AAAqF,KAD/G;AAEHgF,IAAAA,cAAc,EAAE,YAAY;AACxB7C,MAAAA,qBAAqB,GAAG,IAAxB;AACAG,MAAAA,sBAAsB,GAAGzF,cAAc,CAAEoC,MAAM,CAACS,cAAP,IAAyB,EAA3B,CAAvC;AACA,aAAO4C,sBAAP;AACH,KANE;AAOH2C,IAAAA,iBAAiB,EAAE,UAAUxG,EAAV,EAAc;AAC7B,UAAIqB,IAAI,GAAGrB,EAAE,CAACqB,IAAd;AAAA,UAAoB4C,OAAO,GAAGjE,EAAE,CAACiE,OAAjC;;AACA,UAAIhD,cAAc,GAAG7C,cAAc,CAAEoC,MAAM,CAACS,cAAP,IAAyB,EAA3B,CAAnC;;AACA,UAAIwF,MAAM,GAAGxF,cAAc,CAACyF,IAAf,CAAoB,UAAUpG,IAAV,EAAgB;AAC7C,YAAI,CAAC2D,OAAD,IAAY5C,IAAZ,IAAoBA,IAAI,KAAKf,IAAI,CAACe,IAAtC,EAA4C;AACxC,iBAAO,IAAP;AACH;;AACD,YAAIsF,uBAAuB,GAAG1C,OAAO,IAAI,oBAAoB3D,IAA7D;;AACA,YAAI,CAACqG,uBAAL,EAA8B;AAC1B;AACH;;AACD,YAAI1C,OAAO,KAAK3D,IAAI,CAAC4D,cAAL,CAAoBD,OAAhC,IACAA,OAAO,KAAK3D,IAAI,CAAC4D,cAAL,CAAoB7C,IADpC,EAC0C;AACtC,iBAAO,IAAP;AACH;;AACD,eAAO,KAAP;AACH,OAbY,CAAb;AAcA,aAAQoF,MAAM,IAAI,oBAAoBA,MAA9B,GAAuCA,MAAM,CAACvC,cAA9C,GAA+DuC,MAAvE;AACH,KAzBE;AA0BHlD,IAAAA,gBAAgB,EAAE,YAAY;AAAE,aAAO/C,MAAM,CAACoG,gBAAd;AAAiC,KA1B9D;AA2BH3G,IAAAA,EAAE,EAAEA,EA3BD;AA4BH4G,IAAAA,UAAU,EAAE,UAAUhG,MAAV,EAAkB6B,MAAlB,EAA0BoE,OAA1B,EAAmC9G,EAAnC,EAAuC;AAC/C,UAAIiC,EAAE,GAAGjC,EAAE,KAAK,KAAK,CAAZ,GAAgB,EAAhB,GAAqBA,EAA9B;AAAA,UAAkCmG,IAAI,GAAGlE,EAAE,CAACkE,IAA5C;AAAA,UAAkDrD,SAAS,GAAGb,EAAE,CAACa,SAAjE;;AACA,aAAOtB,QAAQ,CAAC;AAAEX,QAAAA,MAAM,EAAEA,MAAV;AAAkBsF,QAAAA,IAAI,EAAEA,IAAxB;AAA8BrD,QAAAA,SAAS,EAAEA;AAAzC,OAAD,EAAuD,UAAUxC,IAAV,EAAgB;AAClF,YAAIA,IAAI,CAACe,IAAL,KAAc,gBAAd,IAAkCqB,MAAtC,EAA8C;AAC1CA,UAAAA,MAAM,CAACpC,IAAI,CAAC4D,cAAN,CAAN;AACA;AACH;;AACD,YAAI5D,IAAI,CAACe,IAAL,KAAc,iBAAd,IAAmCyF,OAAvC,EAAgD;AAC5CA,UAAAA,OAAO,CAACxG,IAAI,CAAC6D,eAAN,CAAP;AACA;AACH;;AACDH,QAAAA,WAAW,CAAC1D,IAAD,CAAX;AACH,OAVc,CAAf;AAWH,KAzCE;AA0CHkB,IAAAA,QAAQ,EAAEA,QA1CP;AA2CHuF,IAAAA,WAAW,EAAE,UAAUC,YAAV,EAAwB;AACjCxD,MAAAA,eAAe,GAAGwD,YAAlB;AACH,KA7CE;AA8CHC,IAAAA,mBAAmB,EAAE,UAAUC,oBAAV,EAAgC;AACjDzD,MAAAA,uBAAuB,GAAGyD,oBAA1B;AACH,KAhDE;AAiDHzF,IAAAA,WAAW,EAAE,UAAU0F,WAAV,EAAuB;AAChC,UAAInH,EAAJ;;AACA,OAACA,EAAE,GAAGQ,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwClB,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAACyB,WAAH,CAAeV,IAAI,CAACC,SAAL,CAAe;AAAEmG,QAAAA,WAAW,EAAE;AAAEC,UAAAA,OAAO,EAAED;AAAX;AAAf,OAAf,CAAf,CAAjE;AACH,KApDE;AAqDHxF,IAAAA,QAAQ,EAAE,UAAUC,KAAV,EAAiB;AACvB,UAAI5B,EAAJ;;AACA,OAACA,EAAE,GAAGQ,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwClB,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAAC2B,QAAH,CAAYZ,IAAI,CAACC,SAAL,CAAe;AAAEY,QAAAA,KAAK,EAAEA;AAAT,OAAf,CAAZ,CAAjE;AACH,KAxDE;AAyDHE,IAAAA,QAAQ,EAAE,UAAUC,OAAV,EAAmB;AAAE,UAAI/B,EAAJ;;AAAQ,aAAO,CAACA,EAAE,GAAGQ,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwClB,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAAC8B,QAAH,CAAYC,OAAZ,CAAxE;AAA+F,KAzDnI;AA0DHF,IAAAA,KAAK,EAAE,YAAY;AAAE,UAAI7B,EAAJ;;AAAQ,aAAO,CAACA,EAAE,GAAGQ,MAAM,CAACU,aAAb,MAAgC,IAAhC,IAAwClB,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAAC6B,KAAH,EAAxE;AAAqF;AA1D/G,GAAP;AA4DH,CAlND;;AAoNA,SAASwB,eAAe,IAAIxF,CAA5B,EAA+B2B,EAAE,IAAI6H,CAArC","sourcesContent":["import { c as createNanoEvents, _ as __rest, a as __assign, b as __spreadArrays, p as proto } from './typings-79533271.js';\n\n// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n// find the complete implementation of crypto (msCrypto) on IE11.\nvar getRandomValues = typeof crypto != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto != 'undefined' && typeof msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto);\nvar rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\nfunction rng() {\n  if (!getRandomValues) {\n    throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n  }\n\n  return getRandomValues(rnds8);\n}\n\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex; // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n\n  return [bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]]].join('');\n}\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof options == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nvar createNanoObservable = function (observerFunc) {\n    var _a = createNanoEvents(), on = _a.on, emit = _a.emit;\n    var subscribe = function (_a) {\n        var next = _a.next;\n        var unsubscribe = on('next', next);\n        return { unsubscribe: unsubscribe };\n    };\n    observerFunc({\n        next: function (data) {\n            emit('next', data);\n        },\n    });\n    return {\n        subscribe: subscribe,\n    };\n};\n\nfunction inIframe() {\n    try {\n        return window.self !== window.top;\n    }\n    catch (e) {\n        return true;\n    }\n}\nif (typeof window !== 'undefined' && inIframe()) {\n    var postMessage_1 = function (action) {\n        var _a;\n        (_a = window.top) === null || _a === void 0 ? void 0 : _a.postMessage(JSON.stringify(action), '*');\n    };\n    window.appInitialData = [];\n    window.AssistantHost = {\n        sendDataContainer: function (json) {\n            postMessage_1({ type: 'sendDataContainer', payload: json });\n        },\n        close: function () {\n            postMessage_1({ type: 'close' });\n        },\n        sendData: function (json) {\n            postMessage_1({ type: 'sendData', payload: json });\n        },\n        setSuggests: function (suggests) {\n            postMessage_1({ type: 'setSuggests', payload: suggests });\n        },\n        setHints: function (hints) {\n            postMessage_1({ type: 'setHints', payload: hints });\n        },\n        ready: function () {\n            postMessage_1({ type: 'ready' });\n        },\n        sendText: function (message) {\n            postMessage_1({ type: 'sendText', payload: message });\n        },\n    };\n    window.addEventListener('message', function (e) {\n        var _a, _b, _c, _d, _e, _f, _g, _h;\n        try {\n            if (typeof e.data === 'string') {\n                var data = JSON.parse(e.data);\n                switch (data.type) {\n                    case 'onData':\n                        (_b = (_a = window.AssistantClient) === null || _a === void 0 ? void 0 : _a.onData) === null || _b === void 0 ? void 0 : _b.call(_a, data.payload);\n                        break;\n                    case 'onRequestState': {\n                        var state = (_d = (_c = window.AssistantClient) === null || _c === void 0 ? void 0 : _c.onRequestState) === null || _d === void 0 ? void 0 : _d.call(_c);\n                        postMessage_1({ type: 'state', payload: state, requestId: data.requestId });\n                        break;\n                    }\n                    case 'onRequestRecoveryState': {\n                        var recoverystate = (_f = (_e = window.AssistantClient) === null || _e === void 0 ? void 0 : _e.onRequestRecoveryState) === null || _f === void 0 ? void 0 : _f.call(_e);\n                        postMessage_1({ type: 'recoveryState', payload: recoverystate });\n                        break;\n                    }\n                    case 'onStart':\n                        (_h = (_g = window.AssistantClient) === null || _g === void 0 ? void 0 : _g.onStart) === null || _h === void 0 ? void 0 : _h.call(_g);\n                        break;\n                    default:\n                        // eslint-disable-next-line no-console\n                        console.error(e, 'Unknown parsed message');\n                        break;\n                }\n            }\n        }\n        catch (err) {\n            // eslint-disable-next-line no-console\n            console.error(err, 'Unknown message');\n        }\n    });\n}\nvar createAssistant = function (_a) {\n    var getState = _a.getState, getRecoveryState = _a.getRecoveryState, _b = _a.ready, ready = _b === void 0 ? true : _b;\n    var currentGetState = getState;\n    var currentGetRecoveryState = getRecoveryState;\n    var isInitialDataReceived = false;\n    var isInitialCommandsEmitted = false;\n    /**\n     * Стартовые команды на момент `window.AssistantClient.onStart()`.\n     * Сохраняются однажды и не обновляются.\n     * */\n    var stackAppInitialData = [];\n    /**\n     * Стартовые команды, которые были получены методом `getInitialData()`.\n     * Они не будут заэмичены при `window.AssistantClient.onStart()`.\n     * */\n    var receivedAppInitialData = [];\n    var _c = createNanoEvents(), on = _c.on, emit = _c.emit;\n    var observables = new Map();\n    var emitCommand = function (command) {\n        if (command.type === 'smart_app_data') {\n            emit('command', command.smart_app_data);\n        }\n        if (command.type === 'smart_app_error') {\n            emit('error', command.smart_app_error);\n        }\n        return emit('data', command);\n    };\n    var findSystemCommandIndex = function (command) {\n        var _a, _b;\n        var index = -1;\n        if (command.type === 'character') {\n            index = stackAppInitialData.findIndex(function (c) { return c.type === 'character' && c.character.id === command.character.id; });\n        }\n        else if (command.type === 'insets') {\n            index = stackAppInitialData.findIndex(function (c) { return c.type === 'insets'; });\n        }\n        else if (command.type === 'app_context') {\n            index = stackAppInitialData.findIndex(function (c) { return c.type === 'app_context'; });\n        }\n        else if (command.sdk_meta && ((_a = command.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid) && ((_b = command.sdk_meta) === null || _b === void 0 ? void 0 : _b.mid) !== '-1') {\n            index = stackAppInitialData.findIndex(function (c) { var _a, _b; return ((_a = c.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid) === ((_b = command.sdk_meta) === null || _b === void 0 ? void 0 : _b.mid); });\n        }\n        return index;\n    };\n    var saveAppInitialData = function () {\n        stackAppInitialData = __spreadArrays((window.appInitialData || []));\n    };\n    var isCommandWasReceived = function (command) {\n        for (var _i = 0, receivedAppInitialData_1 = receivedAppInitialData; _i < receivedAppInitialData_1.length; _i++) {\n            var receivedCommand = receivedAppInitialData_1[_i];\n            if (receivedCommand === command) {\n                return true;\n            }\n        }\n        return false;\n    };\n    var emitAppInitialData = function () {\n        if (!isInitialCommandsEmitted) {\n            var currentInitialData = stackAppInitialData;\n            var notReceivedCommands = isInitialDataReceived === true\n                ? currentInitialData.filter(function (c) { return !isCommandWasReceived(c); })\n                : currentInitialData;\n            notReceivedCommands.forEach(function (c) { return emitCommand(c); });\n            isInitialCommandsEmitted = true;\n        }\n    };\n    window.AssistantClient = {\n        onData: function (command) {\n            var _a, _b, _c;\n            var commandIndex = findSystemCommandIndex(command);\n            var isCommandExist = commandIndex >= 0;\n            if (isCommandExist) {\n                stackAppInitialData.splice(commandIndex, 1);\n                return;\n            }\n            /// фильтр команды 'назад'\n            /// может приходить type='system', но в типах это не отражаем\n            // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n            // @ts-ignore\n            if (command.type === 'system' && ((_b = (_a = command.system) === null || _a === void 0 ? void 0 : _a.command) === null || _b === void 0 ? void 0 : _b.toUpperCase()) === 'BACK') {\n                return;\n            }\n            if ((command.type === 'smart_app_data' || command.type === 'smart_app_error') && ((_c = command.sdk_meta) === null || _c === void 0 ? void 0 : _c.requestId) &&\n                observables.has(command.sdk_meta.requestId)) {\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                var _d = command.sdk_meta, realReqId = _d.requestId, meta = __rest(_d, [\"requestId\"]);\n                var _e = observables.get(command.sdk_meta.requestId) || {}, requestId = _e.requestId, next = _e.next;\n                if (Object.keys(meta).length > 0 || requestId) {\n                    // eslint-disable-next-line @typescript-eslint/camelcase\n                    command.sdk_meta = __assign({}, meta);\n                    if (requestId) {\n                        // eslint-disable-next-line @typescript-eslint/camelcase\n                        command.sdk_meta = { requestId: requestId };\n                    }\n                }\n                if (next) {\n                    next(command.type === 'smart_app_data' ? command : command);\n                }\n                return;\n            }\n            emitCommand(command);\n        },\n        onRequestState: function () {\n            return currentGetState();\n        },\n        onRequestRecoveryState: function () {\n            if (currentGetRecoveryState) {\n                return currentGetRecoveryState();\n            }\n            return undefined;\n        },\n        onStart: function () {\n            emit('start');\n            saveAppInitialData();\n            emitAppInitialData();\n        },\n    };\n    if (ready) {\n        setTimeout(function () { var _a; return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.ready(); }); // таймаут для подписки на start\n    }\n    var sendData = function (_a, onData) {\n        var _b, _c, _d;\n        var action = _a.action, name = _a.name, requestId = _a.requestId;\n        if ((_b = window.AssistantHost) === null || _b === void 0 ? void 0 : _b.sendDataContainer) {\n            if (onData == null) {\n                (_c = window.AssistantHost) === null || _c === void 0 ? void 0 : _c.sendDataContainer(\n                /* eslint-disable-next-line @typescript-eslint/camelcase */\n                JSON.stringify({ data: action, message_name: name || '', requestId: requestId }));\n                return function () { };\n            }\n            if (requestId && observables.has(requestId)) {\n                throw new Error('requestId должен быть уникальным');\n            }\n            var subscribe = createNanoObservable(function (_a) {\n                var _b;\n                var next = _a.next;\n                var realRequestId = requestId || v4();\n                (_b = window.AssistantHost) === null || _b === void 0 ? void 0 : _b.sendDataContainer(\n                /* eslint-disable-next-line @typescript-eslint/camelcase */\n                JSON.stringify({ data: action, message_name: name || '', requestId: realRequestId }));\n                observables.set(realRequestId, { next: next, requestId: requestId });\n            }).subscribe;\n            return subscribe({ next: onData }).unsubscribe;\n        }\n        if (onData != null) {\n            throw new Error('Не поддерживается в данной версии клиента');\n        }\n        (_d = window.AssistantHost) === null || _d === void 0 ? void 0 : _d.sendData(JSON.stringify(action), name || null);\n        return function () { };\n    };\n    return {\n        close: function () { var _a; return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.close(); },\n        getInitialData: function () {\n            isInitialDataReceived = true;\n            receivedAppInitialData = __spreadArrays((window.appInitialData || []));\n            return receivedAppInitialData;\n        },\n        findInInitialData: function (_a) {\n            var type = _a.type, command = _a.command;\n            var appInitialData = __spreadArrays((window.appInitialData || []));\n            var result = appInitialData.find(function (data) {\n                if (!command && type && type === data.type) {\n                    return true;\n                }\n                var isCommandInSmartAppData = command && 'smart_app_data' in data;\n                if (!isCommandInSmartAppData) {\n                    return;\n                }\n                if (command === data.smart_app_data.command ||\n                    command === data.smart_app_data.type) {\n                    return true;\n                }\n                return false;\n            });\n            return (result && 'smart_app_data' in result ? result.smart_app_data : result);\n        },\n        getRecoveryState: function () { return window.appRecoveryState; },\n        on: on,\n        sendAction: function (action, onData, onError, _a) {\n            var _b = _a === void 0 ? {} : _a, name = _b.name, requestId = _b.requestId;\n            return sendData({ action: action, name: name, requestId: requestId }, function (data) {\n                if (data.type === 'smart_app_data' && onData) {\n                    onData(data.smart_app_data);\n                    return;\n                }\n                if (data.type === 'smart_app_error' && onError) {\n                    onError(data.smart_app_error);\n                    return;\n                }\n                emitCommand(data);\n            });\n        },\n        sendData: sendData,\n        setGetState: function (nextGetState) {\n            currentGetState = nextGetState;\n        },\n        setGetRecoveryState: function (nextGetRecoveryState) {\n            currentGetRecoveryState = nextGetRecoveryState;\n        },\n        setSuggests: function (suggestions) {\n            var _a;\n            (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.setSuggests(JSON.stringify({ suggestions: { buttons: suggestions } }));\n        },\n        setHints: function (hints) {\n            var _a;\n            (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.setHints(JSON.stringify({ hints: hints }));\n        },\n        sendText: function (message) { var _a; return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.sendText(message); },\n        ready: function () { var _a; return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.ready(); },\n    };\n};\n\nexport { createAssistant as c, v4 as v };\n"]},"metadata":{},"sourceType":"module"}