{"ast":null,"code":"import { c as createNanoEvents, _ as __spreadArrays, a as __rest, b as __assign, p as proto } from './typings-4aa98dc6.js'; // Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n// find the complete implementation of crypto (msCrypto) on IE11.\n\nvar getRandomValues = typeof crypto != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto != 'undefined' && typeof msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto);\nvar rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\nfunction rng() {\n  if (!getRandomValues) {\n    throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n  }\n\n  return getRandomValues(rnds8);\n}\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex; // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n\n  return [bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]]].join('');\n}\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof options == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nvar createNanoObservable = function (observerFunc) {\n  var _a = createNanoEvents(),\n      on = _a.on,\n      emit = _a.emit;\n\n  var subscribe = function (_a) {\n    var next = _a.next;\n    var unsubscribe = on('next', next);\n    return {\n      unsubscribe: unsubscribe\n    };\n  };\n\n  observerFunc({\n    next: function (data) {\n      emit('next', data);\n    }\n  });\n  return {\n    subscribe: subscribe\n  };\n};\n\nfunction inIframe() {\n  try {\n    return window.self !== window.top;\n  } catch (e) {\n    return true;\n  }\n}\n\nif (typeof window !== 'undefined' && inIframe()) {\n  var postMessage_1 = function (action) {\n    window.top.postMessage(JSON.stringify(action), '*');\n  };\n\n  window.AssistantHost = {\n    sendDataContainer: function (json) {\n      postMessage_1({\n        type: 'sendDataContainer',\n        payload: json\n      });\n    },\n    close: function () {\n      postMessage_1({\n        type: 'close'\n      });\n    },\n    sendData: function (json) {\n      postMessage_1({\n        type: 'sendData',\n        payload: json\n      });\n    },\n    setSuggests: function (suggests) {\n      postMessage_1({\n        type: 'setSuggests',\n        payload: suggests\n      });\n    },\n    setHints: function (hints) {\n      postMessage_1({\n        type: 'setHints',\n        payload: hints\n      });\n    },\n    ready: function () {\n      postMessage_1({\n        type: 'ready'\n      });\n    }\n  };\n  window.addEventListener('message', function (e) {\n    var _a, _b, _c, _d, _e, _f, _g, _h;\n\n    try {\n      if (typeof e.data === 'string') {\n        var data = JSON.parse(e.data);\n\n        switch (data.type) {\n          case 'onData':\n            (_b = (_a = window.AssistantClient) === null || _a === void 0 ? void 0 : _a.onData) === null || _b === void 0 ? void 0 : _b.call(_a, data.payload);\n            break;\n\n          case 'onRequestState':\n            {\n              var state = (_d = (_c = window.AssistantClient) === null || _c === void 0 ? void 0 : _c.onRequestState) === null || _d === void 0 ? void 0 : _d.call(_c);\n              postMessage_1({\n                type: 'state',\n                payload: state,\n                requestId: data.requestId\n              });\n              break;\n            }\n\n          case 'onRequestRecoveryState':\n            {\n              var recoverystate = (_f = (_e = window.AssistantClient) === null || _e === void 0 ? void 0 : _e.onRequestRecoveryState) === null || _f === void 0 ? void 0 : _f.call(_e);\n              postMessage_1({\n                type: 'recoveryState',\n                payload: recoverystate\n              });\n              break;\n            }\n\n          case 'onStart':\n            (_h = (_g = window.AssistantClient) === null || _g === void 0 ? void 0 : _g.onStart) === null || _h === void 0 ? void 0 : _h.call(_g);\n            break;\n\n          default:\n            // eslint-disable-next-line no-console\n            console.error(e, 'Unknown parsed message');\n            break;\n        }\n      }\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error(err, 'Unknown message');\n    }\n  });\n}\n\nvar createAssistant = function (_a) {\n  var getState = _a.getState,\n      getRecoveryState = _a.getRecoveryState;\n  var initialDataConsumed = false;\n  var currentGetState = getState;\n  var currentGetRecoveryState = getRecoveryState;\n\n  var _b = createNanoEvents(),\n      on = _b.on,\n      emit = _b.emit;\n\n  var startedAppInitialData = __spreadArrays(window.appInitialData || []);\n\n  var initialData = __spreadArrays(window.appInitialData || []);\n\n  var observables = new Map();\n\n  var emitCommand = function (command) {\n    if (command.type === 'smart_app_data') {\n      emit('command', command.smart_app_data);\n    }\n\n    if (command.type === 'smart_app_error') {\n      emit('error', command.smart_app_error);\n    }\n\n    return emit('data', command);\n  };\n\n  window.AssistantClient = {\n    onData: function (command) {\n      var _a, _b, _c, _d, _e;\n\n      if (initialData.length) {\n        var index = -1;\n\n        if (command.type === 'character') {\n          index = initialData.findIndex(function (c) {\n            return c.type === 'character' && c.character.id === command.character.id;\n          });\n        } else if (command.type === 'insets') {\n          index = initialData.findIndex(function (c) {\n            return c.type === 'insets';\n          });\n        } else if (command.type === 'app_context') {\n          index = initialData.findIndex(function (c) {\n            return c.type === 'app_context';\n          });\n        } else if (command.sdk_meta && ((_a = command.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid) && ((_b = command.sdk_meta) === null || _b === void 0 ? void 0 : _b.mid) !== '-1') {\n          index = initialData.findIndex(function (c) {\n            var _a, _b;\n\n            return ((_a = c.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid) === ((_b = command.sdk_meta) === null || _b === void 0 ? void 0 : _b.mid);\n          });\n        }\n\n        if (index >= 0) {\n          initialData.splice(index, 1);\n          return;\n        }\n      } /// фильтр команды 'назад'\n      /// может приходить type='system', но в типах это не отражаем\n      // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n      // @ts-ignore\n\n\n      if (command.type === 'system' && ((_d = (_c = command.system) === null || _c === void 0 ? void 0 : _c.command) === null || _d === void 0 ? void 0 : _d.toUpperCase()) === 'BACK') {\n        return;\n      }\n\n      if ((command.type === 'smart_app_data' || command.type === 'smart_app_error') && ((_e = command.sdk_meta) === null || _e === void 0 ? void 0 : _e.requestId) && observables.has(command.sdk_meta.requestId)) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        var _f = command.sdk_meta,\n            realReqId = _f.requestId,\n            meta = __rest(_f, [\"requestId\"]);\n\n        var _g = observables.get(command.sdk_meta.requestId) || {},\n            requestId = _g.requestId,\n            next = _g.next;\n\n        if (Object.keys(meta).length > 0 || requestId) {\n          // eslint-disable-next-line @typescript-eslint/camelcase\n          command.sdk_meta = __assign({}, meta);\n\n          if (requestId) {\n            // eslint-disable-next-line @typescript-eslint/camelcase\n            command.sdk_meta = {\n              requestId: requestId\n            };\n          }\n        }\n\n        if (next) {\n          next(command.type === 'smart_app_data' ? command : command);\n        }\n\n        return;\n      }\n\n      emitCommand(command);\n    },\n    onRequestState: function () {\n      return currentGetState();\n    },\n    onRequestRecoveryState: function () {\n      if (currentGetRecoveryState) {\n        return currentGetRecoveryState();\n      }\n\n      return undefined;\n    },\n    onStart: function () {\n      emit('start');\n\n      if (!initialDataConsumed && startedAppInitialData.length) {\n        // делаем рассылку из initialSmartAppData, если она не была считана в getInitialData()\n        startedAppInitialData.map(function (c) {\n          return emitCommand(c);\n        });\n      }\n    }\n  };\n  setTimeout(function () {\n    var _a;\n\n    return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.ready();\n  }); // таймаут для подписки на start\n\n  var sendData = function (_a, onData) {\n    var _b, _c, _d;\n\n    var action = _a.action,\n        name = _a.name,\n        requestId = _a.requestId;\n\n    if ((_b = window.AssistantHost) === null || _b === void 0 ? void 0 : _b.sendDataContainer) {\n      if (onData == null) {\n        (_c = window.AssistantHost) === null || _c === void 0 ? void 0 : _c.sendDataContainer(\n        /* eslint-disable-next-line @typescript-eslint/camelcase */\n        JSON.stringify({\n          data: action,\n          message_name: name || '',\n          requestId: requestId\n        }));\n        return function () {};\n      }\n\n      if (requestId && observables.has(requestId)) {\n        throw new Error('requestId должен быть уникальным');\n      }\n\n      var subscribe = createNanoObservable(function (_a) {\n        var _b;\n\n        var next = _a.next;\n        var realRequestId = requestId || v4();\n        (_b = window.AssistantHost) === null || _b === void 0 ? void 0 : _b.sendDataContainer(\n        /* eslint-disable-next-line @typescript-eslint/camelcase */\n        JSON.stringify({\n          data: action,\n          message_name: name || '',\n          requestId: realRequestId\n        }));\n        observables.set(realRequestId, {\n          next: next,\n          requestId: requestId\n        });\n      }).subscribe;\n      return subscribe({\n        next: onData\n      }).unsubscribe;\n    }\n\n    if (onData != null) {\n      throw new Error('Не поддерживается в данной версии клиента');\n    }\n\n    (_d = window.AssistantHost) === null || _d === void 0 ? void 0 : _d.sendData(JSON.stringify(action), name || null);\n    return function () {};\n  };\n\n  return {\n    close: function () {\n      var _a;\n\n      return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.close();\n    },\n    getInitialData: function () {\n      initialDataConsumed = true;\n      return startedAppInitialData;\n    },\n    getRecoveryState: function () {\n      return window.appRecoveryState;\n    },\n    on: on,\n    sendAction: function (action, onData, onError, _a) {\n      var _b = _a === void 0 ? {} : _a,\n          name = _b.name,\n          requestId = _b.requestId;\n\n      return sendData({\n        action: action,\n        name: name,\n        requestId: requestId\n      }, function (data) {\n        if (data.type === 'smart_app_data' && onData) {\n          onData(data.smart_app_data);\n          return;\n        }\n\n        if (data.type === 'smart_app_error' && onError) {\n          onError(data.smart_app_error);\n          return;\n        }\n\n        emitCommand(data);\n      });\n    },\n    sendData: sendData,\n    setGetState: function (nextGetState) {\n      currentGetState = nextGetState;\n    },\n    setGetRecoveryState: function (nextGetRecoveryState) {\n      currentGetRecoveryState = nextGetRecoveryState;\n    },\n    setSuggests: function (suggest) {\n      var _a;\n\n      return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.setSuggests(suggest);\n    },\n    setHints: function (hints) {\n      var _a;\n\n      return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.setHints(hints);\n    }\n  };\n};\n\nexport { createAssistant as c, v4 as v };","map":{"version":3,"sources":["/Users/a19404057/Documents/assistant-client/assistant-client/examples/todo-canvas-app/node_modules/@sberdevices/assistant-client/esm/createAssistant-ebcea704.js"],"names":["c","createNanoEvents","_","__spreadArrays","a","__rest","b","__assign","p","proto","getRandomValues","crypto","bind","msCrypto","rnds8","Uint8Array","rng","Error","byteToHex","i","toString","substr","bytesToUuid","buf","offset","bth","join","v4","options","Array","rnds","random","ii","createNanoObservable","observerFunc","_a","on","emit","subscribe","next","unsubscribe","data","inIframe","window","self","top","e","postMessage_1","action","postMessage","JSON","stringify","AssistantHost","sendDataContainer","json","type","payload","close","sendData","setSuggests","suggests","setHints","hints","ready","addEventListener","_b","_c","_d","_e","_f","_g","_h","parse","AssistantClient","onData","call","state","onRequestState","requestId","recoverystate","onRequestRecoveryState","onStart","console","error","err","createAssistant","getState","getRecoveryState","initialDataConsumed","currentGetState","currentGetRecoveryState","startedAppInitialData","appInitialData","initialData","observables","Map","emitCommand","command","smart_app_data","smart_app_error","length","index","findIndex","character","id","sdk_meta","mid","splice","system","toUpperCase","has","realReqId","meta","get","Object","keys","undefined","map","setTimeout","name","message_name","realRequestId","set","getInitialData","appRecoveryState","sendAction","onError","setGetState","nextGetState","setGetRecoveryState","nextGetRecoveryState","suggest","v"],"mappings":"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","sourcesContent":["import { c as createNanoEvents, _ as __spreadArrays, a as __rest, b as __assign, p as proto } from './typings-4aa98dc6.js';\n\n// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n// find the complete implementation of crypto (msCrypto) on IE11.\nvar getRandomValues = typeof crypto != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto != 'undefined' && typeof msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto);\nvar rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\nfunction rng() {\n  if (!getRandomValues) {\n    throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n  }\n\n  return getRandomValues(rnds8);\n}\n\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex; // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n\n  return [bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], '-', bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]]].join('');\n}\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof options == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nvar createNanoObservable = function (observerFunc) {\n    var _a = createNanoEvents(), on = _a.on, emit = _a.emit;\n    var subscribe = function (_a) {\n        var next = _a.next;\n        var unsubscribe = on('next', next);\n        return { unsubscribe: unsubscribe };\n    };\n    observerFunc({\n        next: function (data) {\n            emit('next', data);\n        },\n    });\n    return {\n        subscribe: subscribe,\n    };\n};\n\nfunction inIframe() {\n    try {\n        return window.self !== window.top;\n    }\n    catch (e) {\n        return true;\n    }\n}\nif (typeof window !== 'undefined' && inIframe()) {\n    var postMessage_1 = function (action) {\n        window.top.postMessage(JSON.stringify(action), '*');\n    };\n    window.AssistantHost = {\n        sendDataContainer: function (json) {\n            postMessage_1({ type: 'sendDataContainer', payload: json });\n        },\n        close: function () {\n            postMessage_1({ type: 'close' });\n        },\n        sendData: function (json) {\n            postMessage_1({ type: 'sendData', payload: json });\n        },\n        setSuggests: function (suggests) {\n            postMessage_1({ type: 'setSuggests', payload: suggests });\n        },\n        setHints: function (hints) {\n            postMessage_1({ type: 'setHints', payload: hints });\n        },\n        ready: function () {\n            postMessage_1({ type: 'ready' });\n        },\n    };\n    window.addEventListener('message', function (e) {\n        var _a, _b, _c, _d, _e, _f, _g, _h;\n        try {\n            if (typeof e.data === 'string') {\n                var data = JSON.parse(e.data);\n                switch (data.type) {\n                    case 'onData':\n                        (_b = (_a = window.AssistantClient) === null || _a === void 0 ? void 0 : _a.onData) === null || _b === void 0 ? void 0 : _b.call(_a, data.payload);\n                        break;\n                    case 'onRequestState': {\n                        var state = (_d = (_c = window.AssistantClient) === null || _c === void 0 ? void 0 : _c.onRequestState) === null || _d === void 0 ? void 0 : _d.call(_c);\n                        postMessage_1({ type: 'state', payload: state, requestId: data.requestId });\n                        break;\n                    }\n                    case 'onRequestRecoveryState': {\n                        var recoverystate = (_f = (_e = window.AssistantClient) === null || _e === void 0 ? void 0 : _e.onRequestRecoveryState) === null || _f === void 0 ? void 0 : _f.call(_e);\n                        postMessage_1({ type: 'recoveryState', payload: recoverystate });\n                        break;\n                    }\n                    case 'onStart':\n                        (_h = (_g = window.AssistantClient) === null || _g === void 0 ? void 0 : _g.onStart) === null || _h === void 0 ? void 0 : _h.call(_g);\n                        break;\n                    default:\n                        // eslint-disable-next-line no-console\n                        console.error(e, 'Unknown parsed message');\n                        break;\n                }\n            }\n        }\n        catch (err) {\n            // eslint-disable-next-line no-console\n            console.error(err, 'Unknown message');\n        }\n    });\n}\nvar createAssistant = function (_a) {\n    var getState = _a.getState, getRecoveryState = _a.getRecoveryState;\n    var initialDataConsumed = false;\n    var currentGetState = getState;\n    var currentGetRecoveryState = getRecoveryState;\n    var _b = createNanoEvents(), on = _b.on, emit = _b.emit;\n    var startedAppInitialData = __spreadArrays((window.appInitialData || []));\n    var initialData = __spreadArrays((window.appInitialData || []));\n    var observables = new Map();\n    var emitCommand = function (command) {\n        if (command.type === 'smart_app_data') {\n            emit('command', command.smart_app_data);\n        }\n        if (command.type === 'smart_app_error') {\n            emit('error', command.smart_app_error);\n        }\n        return emit('data', command);\n    };\n    window.AssistantClient = {\n        onData: function (command) {\n            var _a, _b, _c, _d, _e;\n            if (initialData.length) {\n                var index = -1;\n                if (command.type === 'character') {\n                    index = initialData.findIndex(function (c) { return c.type === 'character' && c.character.id === command.character.id; });\n                }\n                else if (command.type === 'insets') {\n                    index = initialData.findIndex(function (c) { return c.type === 'insets'; });\n                }\n                else if (command.type === 'app_context') {\n                    index = initialData.findIndex(function (c) { return c.type === 'app_context'; });\n                }\n                else if (command.sdk_meta && ((_a = command.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid) && ((_b = command.sdk_meta) === null || _b === void 0 ? void 0 : _b.mid) !== '-1') {\n                    index = initialData.findIndex(function (c) { var _a, _b; return ((_a = c.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid) === ((_b = command.sdk_meta) === null || _b === void 0 ? void 0 : _b.mid); });\n                }\n                if (index >= 0) {\n                    initialData.splice(index, 1);\n                    return;\n                }\n            }\n            /// фильтр команды 'назад'\n            /// может приходить type='system', но в типах это не отражаем\n            // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n            // @ts-ignore\n            if (command.type === 'system' && ((_d = (_c = command.system) === null || _c === void 0 ? void 0 : _c.command) === null || _d === void 0 ? void 0 : _d.toUpperCase()) === 'BACK') {\n                return;\n            }\n            if ((command.type === 'smart_app_data' || command.type === 'smart_app_error') && ((_e = command.sdk_meta) === null || _e === void 0 ? void 0 : _e.requestId) &&\n                observables.has(command.sdk_meta.requestId)) {\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                var _f = command.sdk_meta, realReqId = _f.requestId, meta = __rest(_f, [\"requestId\"]);\n                var _g = observables.get(command.sdk_meta.requestId) || {}, requestId = _g.requestId, next = _g.next;\n                if (Object.keys(meta).length > 0 || requestId) {\n                    // eslint-disable-next-line @typescript-eslint/camelcase\n                    command.sdk_meta = __assign({}, meta);\n                    if (requestId) {\n                        // eslint-disable-next-line @typescript-eslint/camelcase\n                        command.sdk_meta = { requestId: requestId };\n                    }\n                }\n                if (next) {\n                    next(command.type === 'smart_app_data' ? command : command);\n                }\n                return;\n            }\n            emitCommand(command);\n        },\n        onRequestState: function () {\n            return currentGetState();\n        },\n        onRequestRecoveryState: function () {\n            if (currentGetRecoveryState) {\n                return currentGetRecoveryState();\n            }\n            return undefined;\n        },\n        onStart: function () {\n            emit('start');\n            if (!initialDataConsumed && startedAppInitialData.length) {\n                // делаем рассылку из initialSmartAppData, если она не была считана в getInitialData()\n                startedAppInitialData.map(function (c) { return emitCommand(c); });\n            }\n        },\n    };\n    setTimeout(function () { var _a; return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.ready(); }); // таймаут для подписки на start\n    var sendData = function (_a, onData) {\n        var _b, _c, _d;\n        var action = _a.action, name = _a.name, requestId = _a.requestId;\n        if ((_b = window.AssistantHost) === null || _b === void 0 ? void 0 : _b.sendDataContainer) {\n            if (onData == null) {\n                (_c = window.AssistantHost) === null || _c === void 0 ? void 0 : _c.sendDataContainer(\n                /* eslint-disable-next-line @typescript-eslint/camelcase */\n                JSON.stringify({ data: action, message_name: name || '', requestId: requestId }));\n                return function () { };\n            }\n            if (requestId && observables.has(requestId)) {\n                throw new Error('requestId должен быть уникальным');\n            }\n            var subscribe = createNanoObservable(function (_a) {\n                var _b;\n                var next = _a.next;\n                var realRequestId = requestId || v4();\n                (_b = window.AssistantHost) === null || _b === void 0 ? void 0 : _b.sendDataContainer(\n                /* eslint-disable-next-line @typescript-eslint/camelcase */\n                JSON.stringify({ data: action, message_name: name || '', requestId: realRequestId }));\n                observables.set(realRequestId, { next: next, requestId: requestId });\n            }).subscribe;\n            return subscribe({ next: onData }).unsubscribe;\n        }\n        if (onData != null) {\n            throw new Error('Не поддерживается в данной версии клиента');\n        }\n        (_d = window.AssistantHost) === null || _d === void 0 ? void 0 : _d.sendData(JSON.stringify(action), name || null);\n        return function () { };\n    };\n    return {\n        close: function () { var _a; return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.close(); },\n        getInitialData: function () {\n            initialDataConsumed = true;\n            return startedAppInitialData;\n        },\n        getRecoveryState: function () { return window.appRecoveryState; },\n        on: on,\n        sendAction: function (action, onData, onError, _a) {\n            var _b = _a === void 0 ? {} : _a, name = _b.name, requestId = _b.requestId;\n            return sendData({ action: action, name: name, requestId: requestId }, function (data) {\n                if (data.type === 'smart_app_data' && onData) {\n                    onData(data.smart_app_data);\n                    return;\n                }\n                if (data.type === 'smart_app_error' && onError) {\n                    onError(data.smart_app_error);\n                    return;\n                }\n                emitCommand(data);\n            });\n        },\n        sendData: sendData,\n        setGetState: function (nextGetState) {\n            currentGetState = nextGetState;\n        },\n        setGetRecoveryState: function (nextGetRecoveryState) {\n            currentGetRecoveryState = nextGetRecoveryState;\n        },\n        setSuggests: function (suggest) { var _a; return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.setSuggests(suggest); },\n        setHints: function (hints) { var _a; return (_a = window.AssistantHost) === null || _a === void 0 ? void 0 : _a.setHints(hints); },\n    };\n};\n\nexport { createAssistant as c, v4 as v };\n"]},"metadata":{},"sourceType":"module"}